#cloud-config
rh_subscription:
  username: {{ .RhelUsername }}
  password: {{ .RhelPassword }}
package_update: true
write_files:
  - content: |
{{ .NodeadmConfig | indent 6 }}
    path: nodeadm-config.yaml
runcmd:
  - echo "Downloading nodeadm binary"
  - curl -L "{{ .NodeadmUrl }}" -o /tmp/nodeadm
  - chmod +x /tmp/nodeadm
  - echo "Installing kubernetes components"
  - /tmp/nodeadm install {{ .KubernetesVersion }} --containerd-source docker --credential-provider {{ .Provider }}
  - echo "Initializing the node"
  - /tmp/nodeadm init -c file:///nodeadm-config.yaml

final_message: "The system is prepped, after $UPTIME seconds"
